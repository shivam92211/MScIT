# Demonstrate the use of **Snort** and **Firewall Rules** on an Ubuntu system.

## Link [Here](https://itexamanswers.net/26-1-7-lab-snort-and-firewall-rules-answers.html)

---

### **Step 1: Update and Prepare the Ubuntu System**
1. **Update the System**:
   Ensure your Ubuntu system is up to date.
   ```bash
   sudo apt update && sudo apt upgrade -y
   ```

2. **Install Required Dependencies**:
   Install necessary packages for Snort and firewall configuration.
   ```bash
   sudo apt install -y snort build-essential libpcap-dev libpcre3-dev libdumbnet-dev bison flex zlib1g-dev liblzma-dev openssl libssl-dev
   ```

---

### **Step 2: Install and Configure Snort**
1. **Install Snort**:
   Install Snort from the Ubuntu repository.
   ```bash
   sudo apt install -y snort
   ```

2. **Configure Snort**:
   - Edit the Snort configuration file to define your network settings.
   ```bash
   sudo nano /etc/snort/snort.conf
   ```
   - Locate the following lines and update them with your network details:
     ```bash
     ipvar HOME_NET 192.168.1.0/24  # Replace with your network
     ipvar EXTERNAL_NET !$HOME_NET
     ```
   - Save and exit the file (`Ctrl+O`, `Enter`, `Ctrl+X`).

3. **Test Snort Configuration**:
   Verify that the configuration file is valid.
   ```bash
   sudo snort -T -c /etc/snort/snort.conf
   ```

---

### **Step 3: Create Custom Snort Rules**
1. **Create a Local Rules File**:
   Create a custom rules file for Snort.
   ```bash
   sudo nano /etc/snort/rules/local.rules
   ```

2. **Add a Sample Rule**:
   Add a rule to detect ICMP (ping) traffic as an example.
   ```bash
   alert icmp any any -> $HOME_NET any (msg:"ICMP Ping Detected"; sid:1000001; rev:1;)
   ```

3. **Include the Local Rules File**:
   Edit the Snort configuration file to include the local rules.
   ```bash
   sudo nano /etc/snort/snort.conf
   ```
   Add the following line:
   ```bash
   include $RULE_PATH/local.rules
   ```

4. **Restart Snort**:
   Restart Snort to apply the new rules.
   ```bash
   sudo systemctl restart snort
   ```

---

### **Step 4: Run Snort in IDS Mode**
1. **Start Snort in IDS Mode**:
   Run Snort in Intrusion Detection System (IDS) mode.
   ```bash
   sudo snort -A console -q -c /etc/snort/snort.conf -i eth0
   ```
   Replace `eth0` with your network interface name (use `ip a` to check).

2. **Generate Traffic to Test Snort**:
   From another machine, ping the Ubuntu system to trigger the ICMP rule.
   ```bash
   ping <Ubuntu_IP_Address>
   ```

3. **Observe Snort Alerts**:
   Snort will display alerts in the terminal for detected ICMP traffic.

---

### **Step 5: Configure Firewall Rules with UFW**
1. **Install UFW**:
   Install the Uncomplicated Firewall (UFW) if not already installed.
   ```bash
   sudo apt install -y ufw
   ```

2. **Set Default Policies**:
   Configure default policies to deny incoming traffic and allow outgoing traffic.
   ```bash
   sudo ufw default deny incoming
   sudo ufw default allow outgoing
   ```

3. **Allow SSH Access**:
   Allow SSH to ensure you donâ€™t lose access to the system.
   ```bash
   sudo ufw allow ssh
   ```

4. **Enable the Firewall**:
   Enable UFW to apply the rules.
   ```bash
   sudo ufw enable
   ```

5. **Check Firewall Status**:
   Verify the firewall status and rules.
   ```bash
   sudo ufw status verbose
   ```

---

### **Step 6: Test Firewall Rules**
1. **Block ICMP Traffic**:
   Add a rule to block ICMP (ping) traffic.
   ```bash
   sudo ufw deny in proto icmp
   ```

2. **Test the Block**:
   From another machine, try to ping the Ubuntu system. The ping should fail.
   ```bash
   ping <Ubuntu_IP_Address>
   ```

3. **Allow ICMP Traffic**:
   Remove the ICMP block rule to allow ping traffic again.
   ```bash
   sudo ufw delete deny in proto icmp
   ```

---

### **Step 7: Clean Up**
1. **Stop Snort**:
   Stop Snort if it is running.
   ```bash
   sudo systemctl stop snort
   ```

2. **Reset Firewall Rules**:
   Reset UFW to its default state if needed.
   ```bash
   sudo ufw reset
   ```

---

### **Summary of Commands**
```bash
# Update and install dependencies
sudo apt update && sudo apt upgrade -y
sudo apt install -y snort build-essential libpcap-dev libpcre3-dev libdumbnet-dev bison flex zlib1g-dev liblzma-dev openssl libssl-dev

# Install Snort
sudo apt install -y snort

# Configure Snort
sudo nano /etc/snort/snort.conf
sudo nano /etc/snort/rules/local.rules

# Test Snort configuration
sudo snort -T -c /etc/snort/snort.conf

# Run Snort in IDS mode
sudo snort -A console -q -c /etc/snort/snort.conf -i eth0

# Install and configure UFW
sudo apt install -y ufw
sudo ufw default deny incoming
sudo ufw default allow outgoing
sudo ufw allow ssh
sudo ufw enable

# Block and test ICMP traffic
sudo ufw deny in proto icmp
ping <Ubuntu_IP_Address>
sudo ufw delete deny in proto icmp
```
