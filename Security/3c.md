# **Explore DNS traffic** using **Wireshark** on an Ubuntu system.

## Link [Here](https://itexamanswers.net/3-8-8-lab-explore-dns-traffic-answers.html)

---

### **Step 1: Update and Prepare the Ubuntu System**
1. **Update the System**:
   Ensure your Ubuntu system is up to date.
   ```bash
   sudo apt update && sudo apt upgrade -y
   ```

2. **Install Wireshark**:
   Install Wireshark for packet capture and analysis.
   ```bash
   sudo apt install -y wireshark
   ```

3. **Add User to Wireshark Group**:
   Allow your user to run Wireshark without root privileges.
   ```bash
   sudo usermod -aG wireshark $USER
   newgrp wireshark
   ```

---

### **Step 2: Capture DNS Traffic**
1. **Start Wireshark**:
   Launch Wireshark and start capturing packets.
   ```bash
   wireshark &
   ```

2. **Select the Network Interface**:
   - In Wireshark, select the active network interface (e.g., `eth0` or `wlan0`).
   - Click **Start** to begin capturing packets.

3. **Flush the DNS Cache**:
   Clear the DNS cache to ensure fresh DNS queries.
   ```bash
   sudo systemd-resolve --flush-caches
   ```

4. **Generate DNS Traffic**:
   Use the `nslookup` command to generate DNS queries.
   ```bash
   nslookup www.cisco.com
   ```

5. **Stop the Capture**:
   After generating DNS traffic, stop the Wireshark capture by clicking **Stop**.

---

### **Step 3: Analyze DNS Query Traffic**
1. **Filter DNS Traffic**:
   In Wireshark, apply the filter `udp.port == 53` to display only DNS packets.

2. **Identify DNS Query Packets**:
   - Look for packets labeled **Standard query**.
   - Select a DNS query packet (e.g., `Standard query 0x0002 A www.cisco.com`).

3. **Examine Packet Details**:
   - Expand the **Ethernet II** section to view the source and destination MAC addresses.
   - Expand the **Internet Protocol Version 4** section to view the source and destination IP addresses.
   - Expand the **User Datagram Protocol** section to view the source and destination ports (DNS uses port 53).

4. **Record MAC and IP Addresses**:
   Use the following commands to record the MAC and IP addresses of your system:
   ```bash
   ip addr show
   arp -a
   ```

---

### **Step 4: Analyze DNS Response Traffic**
1. **Identify DNS Response Packets**:
   - Look for packets labeled **Standard query response**.
   - Select a DNS response packet (e.g., `Standard query response 0x0002 A www.cisco.com`).

2. **Examine Packet Details**:
   - Expand the **Domain Name System (response)** section.
   - Observe the **Flags**, **Queries**, and **Answers** sections.
   - Note the **CNAME** and **A records** in the response.

3. **Compare with `nslookup` Results**:
   Compare the DNS response details in Wireshark with the output of the `nslookup` command.

---

### **Step 5: Reflection and Cleanup**
1. **Reflection Questions**:
   - What can you learn about the network when you remove the DNS filter in Wireshark?
   - How can an attacker use Wireshark to compromise network security?

2. **Stop Wireshark**:
   Close Wireshark after completing the analysis.

3. **Clean Up**:
   Delete any unnecessary files or captures.

---

### **Summary of Commands**
```bash
# Update and install Wireshark
sudo apt update && sudo apt upgrade -y
sudo apt install -y wireshark

# Add user to Wireshark group
sudo usermod -aG wireshark $USER
newgrp wireshark

# Flush DNS cache
sudo systemd-resolve --flush-caches

# Generate DNS traffic
nslookup www.cisco.com

# Record MAC and IP addresses
ip addr show
arp -a
```

---

### **Expected Output**
- **Wireshark DNS Query Packet**:
  - Source MAC: Your system's MAC address.
  - Destination MAC: Default gateway or DNS server's MAC address.
  - Source IP: Your system's IP address.
  - Destination IP: DNS server's IP address.
  - Source Port: Random high port.
  - Destination Port: 53 (DNS).

- **Wireshark DNS Response Packet**:
  - Source MAC: DNS server's MAC address.
  - Destination MAC: Your system's MAC address.
  - Source IP: DNS server's IP address.
  - Destination IP: Your system's IP address.
  - Source Port: 53 (DNS).
  - Destination Port: Random high port.

