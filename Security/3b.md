# **Extract an executable from a PCAP file** using tools like **Wireshark** and **tcpdump** on an Ubuntu system.

## Link [Here](https://itexamanswers.net/27-2-10-lab-extract-an-executable-from-a-pcap-answers.html)

---

### **Step 1: Update and Prepare the Ubuntu System**
1. **Update the System**:
   Ensure your Ubuntu system is up to date.
   ```bash
   sudo apt update && sudo apt upgrade -y
   ```

2. **Install Required Tools**:
   Install Wireshark and other necessary tools.
   ```bash
   sudo apt install -y wireshark tshark tcpdump
   ```

3. **Add User to Wireshark Group**:
   Allow your user to run Wireshark without root privileges.
   ```bash
   sudo usermod -aG wireshark $USER
   newgrp wireshark
   ```

---

### **Step 2: Download the PCAP File**
1. **Download the Sample PCAP File**:
   Download the `nimda.download.pcap` file (or use your own PCAP file).
   ```bash
   wget https://example.com/nimda.download.pcap -O nimda.download.pcap
   ```
   Replace the URL with the actual link to the PCAP file.

---

### **Step 3: Analyze the PCAP File with Wireshark**
1. **Open the PCAP File in Wireshark**:
   Launch Wireshark and open the PCAP file.
   ```bash
   wireshark nimda.download.pcap &
   ```

2. **Identify the HTTP GET Request**:
   - In Wireshark, use the filter `http.request.method == "GET"` to locate the HTTP GET request.
   - Look for the packet that requests the executable file (e.g., `W32.Nimda.Amm.exe`).

3. **Follow the TCP Stream**:
   - Right-click the packet with the HTTP GET request.
   - Select **Follow > TCP Stream**.
   - Observe the raw data in the TCP stream. You may see binary data and strings from the executable.

---

### **Step 4: Extract the Executable from the PCAP File**
1. **Export the HTTP Object**:
   - In Wireshark, go to **File > Export Objects > HTTP**.
   - A list of HTTP objects in the PCAP file will appear.

2. **Save the Executable**:
   - Select the executable file (e.g., `W32.Nimda.Amm.exe`).
   - Click **Save As** and save the file to your desired location (e.g., `/home/$USER/`).

3. **Verify the Extracted File**:
   - Open a terminal and navigate to the directory where the file was saved.
   ```bash
   cd /home/$USER
   ls -l W32.Nimda.Amm.exe
   ```

---

### **Step 5: Analyze the Extracted Executable**
1. **Check File Type**:
   Use the `file` command to confirm the file type.
   ```bash
   file W32.Nimda.Amm.exe
   ```
   Output:
   ```
   W32.Nimda.Amm.exe: PE32+ executable (console) x86-64, for MS Windows
   ```

2. **Calculate File Hash**:
   Generate a hash (e.g., SHA-256) for the file for further analysis.
   ```bash
   sha256sum W32.Nimda.Amm.exe
   ```

3. **Submit to VirusTotal (Optional)**:
   Upload the file to [VirusTotal](https://www.virustotal.com) for malware analysis.

---

### **Step 6: Clean Up**
1. **Delete the Extracted File**:
   If the file is malicious, ensure it is deleted after analysis.
   ```bash
   rm W32.Nimda.Amm.exe
   ```

2. **Close Wireshark**:
   Exit Wireshark after completing the analysis.

---

### **Summary of Commands**
```bash
# Update and install tools
sudo apt update && sudo apt upgrade -y
sudo apt install -y wireshark tshark tcpdump

# Add user to Wireshark group
sudo usermod -aG wireshark $USER
newgrp wireshark

# Download the PCAP file
wget https://example.com/nimda.download.pcap -O nimda.download.pcap

# Open the PCAP file in Wireshark
wireshark nimda.download.pcap &

# Export the executable from the PCAP file
# (Use Wireshark GUI: File > Export Objects > HTTP)

# Verify the extracted file
cd /home/$USER
file W32.Nimda.Amm.exe
sha256sum W32.Nimda.Amm.exe

# Clean up
rm W32.Nimda.Amm.exe
```